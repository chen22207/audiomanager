<include file="__THEME__/public_header" />

<div id="page-wrap">
    <div id="main-wrap">
        <div class="boxShadow">
            <div class="foundation">
                <div class="row">
                    <div class="large-12 columns">
                        <h2>查看已分配任务</h2>
                    </div>
                    <hr/>
                </div>
                <div class="row">
                    <div class="large-3 columns">
                        <p class="right">分配编号：</p>
                    </div>
                    <div class="large-9 columns">
                        <p>{$assign['id']}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="large-3 columns">
                        <p class="right">任务编号：</p>
                    </div>
                    <div class="large-9 columns">
                        <p>{$assign['taskid']}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="large-3 columns">
                        <p class="right">参与人数：</p>
                    </div>
                    <div class="large-9 columns">
                        <php>
                            $joincount = D('CpAssign')->getjoincount($assign['id']);
                        </php>
                        <p>{$joincount}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="large-3 columns">
                        <p class="right">完成人数：</p>
                    </div>
                    <div class="large-9 columns">
                        <php>
                            $finishcount = D('CpAssign')->getfinishcount($assign['id']);
                        </php>
                        <p>{$finishcount}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="large-3 columns">
                        <p class="right">进度：</p>
                    </div>
                    <div class="large-9 columns">
                        <div class="fdprogress">
                            <php>
                                $percent = round($joincount / $finishcount * 100).'%';
                            </php>
                            <span class="meter" style="width: {$percent}%;"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="large-3 columns">
                        <p class="right">任务完成情况：</p>
                    </div>
                    <div class="large-9 columns">
                        <table style="width: 100%;">
                            <thead>
                            <tr>
                                <th>学号</th>
                                <th>姓名</th>
                                <th>音频编号</th>
                                <th>状态</th>
                                <th>完成时间</th>
                            </tr>
                            </thead>
                            <tbody>
                            <php>
                                $assignlinks = D('CpAssignLink')->getpagebyassignid($assign['id']);
                            </php>
                            <volist name="assignlinks['data']" id="e">
                                <tr>
                                    <php>
                                        $user = D('User')->getuserinfo($e['uid']);
                                    </php>
                                    <td>{$user['studentid']}</td>
                                    <td>{$user['uname']}</td>
                                    <td>
                                        <a href="{:U('emomp3/Admin/viewaudio', array('audioid'=>$e['audioid']))}">
                                            {$e['audioid']}
                                        </a>
                                    </td>
                                    <!--状态-->
                                    <if condition="$e['finishtime']">
                                        <td><span class="round success label">已完成</span></td>
                                    </if>
                                    <if condition="!$e['finishtime']">
                                        <td><span class="round secondary label">未完成</span></td>
                                    </if>
                                    <!--完成时间-->
                                    <if condition="$e['finishtime']">
                                        <td>{$finishtime|friendlydate}</td>
                                    </if>
                                    <if condition="!$e['finishtime']">
                                        <td>-</td>
                                    </if>
                                </tr>
                            </volist>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="large-12 columns">
                        <div class="page">
                            {$assignlinks['html']}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<include file="__THEME__/public_footer" />