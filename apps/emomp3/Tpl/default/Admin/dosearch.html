<include file="../Public/public_header" />

<div id="page-wrap">
    <div id="main-wrap">
        <div class="boxShadow">
            <div class="foundation">
                <div class="row">
                    <div class="large-12 columns">
                        <h2>音频搜索 - {$keyword}</h2>
                        <hr/>
                    </div>
                </div>
                <div class="row">
                    <div class="large-10 columns">
                        <input type="text" id="keyword" value="{$keyword|htmlspecialchars}" placeholder="请输入需要搜索的关键字"/>
                    </div>
                    <div class="large-2 columns">
                        <div class="postfix button" id="search2" href="{:U('emomp3/Admin/dosearch')}">搜索</div>
                    </div>
                </div>
                <div class="row">
                    <div class="large-12 columns">
                        <hr/>
                    </div>
                </div>
                <if condition="!$result['data']">
                    <div class="row">
                        <div class="large-12 columns">
                            <p class="center">暂无任何结果</p>
                        </div>
                    </div>
                </if>
                <if condition="$result">
                    <div class="row">
                        <div class="large-12 columns">
                            <p class="right">共找到{$result['count']}个结果</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="large-12 columns">
                            <table style="width: 100%;">
                                <thead>
                                <tr>
                                    <th>音频</th>
                                    <th>包含关键字</th>
                                </tr>
                                </thead>
                                <tbody>
                                <volist name="result['data']" id="e">
                                    <tr>
                                        <td><a href="{:U('emomp3/Admin/viewaudio', array('audioid'=>$e['audioid']))}">{$e['audioid']}</a></td>
                                        <!--获取包含关键字-->
                                        <td>
                                            <php>
                                                $keywords = D('CpSearch')->getlistbyaudioid($e['audioid']);
                                            </php>
                                            <volist name="keywords" id="e">
                                                <php>
                                                    if(strstr($e['keyword'],$keyword)) {
                                                        $color = 'success';
                                                    } else {
                                                        $color = 'secondary';
                                                    }
                                                </php>
                                                <if condition="$e['keyword']">
                                                    <span class="round label {$color}">
                                                    {$e['keyword']}
                                                </span>&nbsp;
                                                </if>
                                            </volist>
                                        </td>
                                    </tr>
                                </volist>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </if>
                <div class="row">
                    <div class="large-12 columns">
                        <p class="page">
                            {$result['html']}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function(){
        //在输入框中按下回车
        $('.foundation #keyword').keydown(function(e){
            if(e.keyCode == 13) {
                $('#search2').trigger('click');
            }
        })
        //点击搜索按钮
        $('#search2').click(function(){
            //get keyword
            var keyword = $('#keyword').val();
            if(keyword == "") {
                ui.error("请输入需要搜索的关键字");
                return;
            }
            keyword = encodeURIComponent(keyword);
            //generate url
            var url = $(this).attr('href');
            url += '&keyword=';
            url += keyword;
            //jump to search result
            location.href = url;
        });
    })
</script>

<include file="__THEME__/public_footer" />